package egovframework.phcf.support.web;

import java.util.ArrayList;
import java.util.Collection;
import java.util.HashMap;
import java.util.Iterator;
import java.util.List;
import java.util.ListIterator;
import java.util.Map;

import javax.annotation.Resource;

import org.apache.commons.beanutils.BeanUtils;
import org.springframework.stereotype.Controller;
import org.springframework.ui.ModelMap;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestParam;

import egovframework.com.cmm.ComDefaultCodeVO;
import egovframework.com.cmm.annotation.IncludedInfo;
import egovframework.com.cmm.service.CmmnDetailCode;
import egovframework.com.cmm.service.EgovCmmUseService;
import egovframework.phcf.support.service.SupportService;
import egovframework.phcf.util.JsonUtil;

@Controller
public class SupportController {
	
	@Resource(name="EgovCmmUseService")
	private EgovCmmUseService cmmUseService;
	
	@Resource(name = "SupportService")
	SupportService supportService;
	
	@SuppressWarnings("unchecked")
	@IncludedInfo(name="후원신청 관리", order=10000, gid=100)
	@RequestMapping(value="/cms/support/list.do")
	public String support(@RequestParam HashMap<String, Object> paramMap, ModelMap model) throws Exception {

		// 회원종류를 가져온다.
		ComDefaultCodeVO voComCode = new ComDefaultCodeVO();
    	voComCode.setCodeId("PHC004");
    	List<CmmnDetailCode> listComCode = cmmUseService.selectCmmCodeDetail(voComCode);
    	
    	model.addAttribute("userTp", JsonUtil.getJsonArrayFromVOList(listComCode));
		
		// 개인회원 등급 리스트를 가져온다.
		model.addAttribute("gradeList", JsonUtil.getJsonArrayFromList(supportService.getGradeCodeList("PHC003")) );
		
		return "egovframework/phcf/support/list";
	}
	
	@RequestMapping(value="/cms/support/getCmsSupportList.do")
	public String getCmsSupportList(@RequestParam HashMap<String, Object> paramMap, ModelMap model) throws Exception {
		
		// 리스트 및 total count 값 적용..
		List<HashMap<String, Object>> cmsSupportList = supportService.getCmsSupportList(paramMap);
		model.addAttribute("value", cmsSupportList);
		// 전체 건수
		int totalCnt = supportService.getCmsSupportCnt(paramMap);
		model.addAttribute("totCnt", totalCnt);
		
		
		return "jsonView";
	}
	
	@RequestMapping(value="/cms/support/updateCmsSupportItem.do")
	public String updateCmsSupportItem(@RequestParam HashMap<String, Object> paramMap, ModelMap model) throws Exception {
		
		System.out.println("== paramMap : " + paramMap);
		
		return "jsonView";
	}
}